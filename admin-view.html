<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VisionRoute Admin - View Database</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }
      .header {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        padding: 30px;
        text-align: center;
      }
      .header h1 {
        font-size: 32px;
        margin-bottom: 10px;
      }
      .header p {
        opacity: 0.9;
      }
      .content {
        padding: 30px;
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .stat-card {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }
      .stat-card h3 {
        font-size: 36px;
        margin-bottom: 5px;
      }
      .stat-card p {
        opacity: 0.9;
      }
      .users-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      .users-table th,
      .users-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }
      .users-table th {
        background: #f5f5f5;
        font-weight: 600;
        color: #333;
      }
      .users-table tr:hover {
        background: #f9f9f9;
      }
      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      .badge-email {
        background: #e3f2fd;
        color: #1976d2;
      }
      .badge-google {
        background: #fff3e0;
        color: #f57c00;
      }
      .badge-verified {
        background: #e8f5e9;
        color: #388e3c;
      }
      .badge-unverified {
        background: #ffebee;
        color: #d32f2f;
      }
      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }
      .error {
        background: #ffebee;
        color: #d32f2f;
        padding: 20px;
        border-radius: 8px;
        margin: 20px;
      }
      .refresh-btn {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin-bottom: 20px;
      }
      .refresh-btn:hover {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéì VisionRoute Admin Dashboard</h1>
        <p>View all registered users and database statistics</p>
      </div>
      <div class="content">
        <button class="refresh-btn" onclick="loadData()">
          üîÑ Refresh Data
        </button>

        <div id="stats-section" class="stats-grid"></div>

        <div id="users-section"></div>
      </div>
    </div>

    <script>
      const API_URL = "http://localhost:5000/api/admin";

      async function loadData() {
        try {
          // Load stats
          const statsResponse = await fetch(`${API_URL}/stats`);
          const statsData = await statsResponse.json();
          displayStats(statsData.stats);

          // Load users
          const usersResponse = await fetch(`${API_URL}/users`);
          const usersData = await usersResponse.json();
          displayUsers(usersData.users);
        } catch (error) {
          document.getElementById("users-section").innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error Loading Data</h3>
                        <p>${error.message}</p>
                        <p>Make sure the backend server is running on http://localhost:5000</p>
                    </div>
                `;
        }
      }

      function displayStats(stats) {
        const statsHTML = `
                <div class="stat-card">
                    <h3>${stats.totalUsers}</h3>
                    <p>Total Users</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.emailRegistrations}</h3>
                    <p>Email Sign-ups</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.googleRegistrations}</h3>
                    <p>Google Sign-ups</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.totalAssessments}</h3>
                    <p>Assessments</p>
                </div>
            `;
        document.getElementById("stats-section").innerHTML = statsHTML;
      }

      function displayUsers(users) {
        if (users.length === 0) {
          document.getElementById("users-section").innerHTML = `
                    <div class="loading">
                        <h3>üì≠ No Users Found</h3>
                        <p>Register a new user to see them appear here!</p>
                    </div>
                `;
          return;
        }

        const usersHTML = `
                <h2 style="margin-bottom: 20px;">üë• Registered Users (${
                  users.length
                })</h2>
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Grade</th>
                            <th>Auth Provider</th>
                            <th>Verified</th>
                            <th>Logins</th>
                            <th>Last Login</th>
                            <th>Registered</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users
                          .map(
                            (user) => `
                            <tr>
                                <td><strong>${user.name}</strong></td>
                                <td>${user.email}</td>
                                <td>${user.phone || "-"}</td>
                                <td>${user.currentGrade || "-"}</td>
                                <td>
                                    <span class="badge badge-${
                                      user.authProvider
                                    }">
                                        ${
                                          user.authProvider === "email"
                                            ? "üìß"
                                            : "üîê"
                                        } ${user.authProvider.toUpperCase()}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge ${
                                      user.isEmailVerified
                                        ? "badge-verified"
                                        : "badge-unverified"
                                    }">
                                        ${user.isEmailVerified ? "‚úì" : "‚úó"}
                                    </span>
                                </td>
                                <td>${user.loginCount}</td>
                                <td>${
                                  user.lastLogin
                                    ? new Date(user.lastLogin).toLocaleString()
                                    : "Never"
                                }</td>
                                <td>${new Date(
                                  user.createdAt
                                ).toLocaleDateString()}</td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            `;
        document.getElementById("users-section").innerHTML = usersHTML;
      }

      // Load data on page load
      loadData();
    </script>
  </body>
</html>
